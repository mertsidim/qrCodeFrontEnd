import * as tslib_1 from "tslib";
import { ChangeDetectionStrategy, Component, Inject, Input, ViewChild, ElementRef, } from '@angular/core';
import { ADSENSE_TOKEN } from './adsense-config';
let AdsenseComponent = class AdsenseComponent {
    constructor(config) {
        this.config = config;
        /** can be manually set if you need all ads on a page to have same id page-xxx */
        this.adRegion = 'page-' + Math.floor(Math.random() * 10000) + 1;
    }
    ngOnInit() {
        const config = this.config;
        function use(source, defaultValue) {
            return config && source !== undefined ? source : defaultValue;
        }
        this.adClient = use(this.adClient, config.adClient);
        this.adSlot = use(this.adSlot, config.adSlot);
        this.adFormat = use(this.adFormat, config.adFormat || 'auto');
        this.display = use(this.display, config.display || 'block');
        this.width = use(this.width, config.width);
        this.height = use(this.height, config.height);
        this.layout = use(this.layout, config.layout);
        this.layoutKey = use(this.layoutKey, config.layoutKey);
        this.pageLevelAds = use(this.pageLevelAds, config.pageLevelAds);
        this.timeOutRetry = use(this.timeOutRetry, config.timeOutRetry || 200);
        this.adtest = use(this.adtest, config.adtest);
        this.fullWidthResponsive = use(this.fullWidthResponsive, config.fullWidthResponsive);
    }
    ngOnDestroy() {
        const iframe = this.ins.nativeElement.querySelector('iframe');
        if (iframe && iframe.contentWindow) {
            iframe.src = 'about:blank';
            iframe.remove();
        }
    }
    /**
     * attempts to push the ad twice. Usually if one doesn't work the other
     * will depeding on if the browser has the adsense code cached and
     * if its the first page to be loaded
     */
    ngAfterViewInit() {
        const res = this.push();
        if (res instanceof TypeError) {
            setTimeout(() => this.push(), this.timeOutRetry);
        }
    }
    push() {
        const p = {};
        if (this.pageLevelAds) {
            p.google_ad_client = this.adClient;
            p.enable_page_level_ads = true;
        }
        try {
            const adsbygoogle = window.adsbygoogle;
            adsbygoogle.push(p);
            return true;
        }
        catch (e) {
            return e;
        }
    }
};
AdsenseComponent.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [ADSENSE_TOKEN,] }] }
];
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], AdsenseComponent.prototype, "adClient", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], AdsenseComponent.prototype, "adSlot", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], AdsenseComponent.prototype, "adFormat", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], AdsenseComponent.prototype, "adRegion", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], AdsenseComponent.prototype, "display", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Number)
], AdsenseComponent.prototype, "width", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Number)
], AdsenseComponent.prototype, "height", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], AdsenseComponent.prototype, "layout", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], AdsenseComponent.prototype, "layoutKey", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Boolean)
], AdsenseComponent.prototype, "pageLevelAds", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Number)
], AdsenseComponent.prototype, "timeOutRetry", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], AdsenseComponent.prototype, "adtest", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Boolean)
], AdsenseComponent.prototype, "fullWidthResponsive", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], AdsenseComponent.prototype, "className", void 0);
tslib_1.__decorate([
    ViewChild('ins', { read: ElementRef, static: true }),
    tslib_1.__metadata("design:type", Object)
], AdsenseComponent.prototype, "ins", void 0);
AdsenseComponent = tslib_1.__decorate([
    Component({
        selector: 'ng2-adsense,ng-adsense',
        template: `
  <ins #ins class="adsbygoogle {{ className }}"
    [style.display]="display"
    [style.width.px]="width"
    [style.height.px]="height"
    [attr.data-ad-client]="adClient"
    [attr.data-ad-slot]="adSlot"
    [attr.data-ad-format]="adFormat"
    [attr.data-ad-region]="adRegion"
    [attr.data-layout]="layout"
    [attr.data-adtest]="adtest"
    [attr.data-layout-key]="layoutKey"
    [attr.data-full-width-responsive]="fullWidthResponsive">
  </ins>
  `,
        changeDetection: ChangeDetectionStrategy.OnPush
    }),
    tslib_1.__param(0, Inject(ADSENSE_TOKEN)),
    tslib_1.__metadata("design:paramtypes", [Object])
], AdsenseComponent);
export { AdsenseComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRzZW5zZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZzItYWRzZW5zZS8iLCJzb3VyY2VzIjpbImFkc2Vuc2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBRUwsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxNQUFNLEVBQ04sS0FBSyxFQUdMLFNBQVMsRUFDVCxVQUFVLEdBQ1gsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLGFBQWEsRUFBaUIsTUFBTSxrQkFBa0IsQ0FBQztBQXFCaEUsSUFBYSxnQkFBZ0IsR0FBN0IsTUFBYSxnQkFBZ0I7SUFnQzNCLFlBQ2lDLE1BQXFCO1FBQXJCLFdBQU0sR0FBTixNQUFNLENBQWU7UUEzQnRELGlGQUFpRjtRQUN4RSxhQUFRLEdBQUcsT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQTJCaEUsQ0FBQztJQUVMLFFBQVE7UUFDTixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQzNCLFNBQVMsR0FBRyxDQUFJLE1BQVMsRUFBRSxZQUFlO1lBQ3hDLE9BQU8sTUFBTSxJQUFJLE1BQU0sS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDO1FBQ2hFLENBQUM7UUFDRCxJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNwRCxJQUFJLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxRQUFRLElBQUksTUFBTSxDQUFD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bUI7QUFFbEI7SUFBUixLQUFLLEVBQUU7O3NEQUF1QjtBQUV0QjtJQUFSLEtBQUssRUFBRTs7c0RBQXNCO0FBRXJCO0lBQVIsS0FBSyxFQUFFOztnREFBZ0I7QUFFZjtJQUFSLEtBQUssRUFBRTs7NkRBQThCO0FBSTdCO0lBQVIsS0FBSyxFQUFFOzttREFBbUI7QUFDMkI7SUFBckQsU0FBUyxDQUFDLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDOzs2Q0FBVTtBQTlCcEQsZ0JBQWdCO0lBbkI1QixTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsd0JBQXdCO1FBQ2xDLFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7Ozs7R0FjVDtRQUNELGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO0tBQ2hELENBQUM7SUFrQ0csbUJBQUEsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFBOztHQWpDYixnQkFBZ0IsQ0F3RjVCO1NBeEZZLGdCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEluamVjdCxcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBWaWV3Q2hpbGQsXG4gIEVsZW1lbnRSZWYsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBBRFNFTlNFX1RPS0VOLCBBZHNlbnNlQ29uZmlnIH0gZnJvbSAnLi9hZHNlbnNlLWNvbmZpZyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25nMi1hZHNlbnNlLG5nLWFkc2Vuc2UnLFxuICB0ZW1wbGF0ZTogYFxuICA8aW5zICNpbnMgY2xhc3M9XCJhZHNieWdvb2dsZSB7eyBjbGFzc05hbWUgfX1cIlxuICAgIFtzdHlsZS5kaXNwbGF5XT1cImRpc3BsYXlcIlxuICAgIFtzdHlsZS53aWR0aC5weF09XCJ3aWR0aFwiXG4gICAgW3N0eWxlLmhlaWdodC5weF09XCJoZWlnaHRcIlxuICAgIFthdHRyLmRhdGEtYWQtY2xpZW50XT1cImFkQ2xpZW50XCJcbiAgICBbYXR0ci5kYXRhLWFkLXNsb3RdPVwiYWRTbG90XCJcbiAgICBbYXR0ci5kYXRhLWFkLWZvcm1hdF09XCJhZEZvcm1hdFwiXG4gICAgW2F0dHIuZGF0YS1hZC1yZWdpb25dPVwiYWRSZWdpb25cIlxuICAgIFthdHRyLmRhdGEtbGF5b3V0XT1cImxheW91dFwiXG4gICAgW2F0dHIuZGF0YS1hZHRlc3RdPVwiYWR0ZXN0XCJcbiAgICBbYXR0ci5kYXRhLWxheW91dC1rZXldPVwibGF5b3V0S2V5XCJcbiAgICBbYXR0ci5kYXRhLWZ1bGwtd2lkdGgtcmVzcG9uc2l2ZV09XCJmdWxsV2lkdGhSZXNwb25zaXZlXCI+XG4gIDwvaW5zPlxuICBgLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgQWRzZW5zZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcbiAgLyoqIGFkc2Vuc2UgYWNjb3VudCBjYS1wdWItWFhYWFhYWFhYWFhYWFhYWCAqL1xuICBASW5wdXQoKSBhZENsaWVudDogc3RyaW5nO1xuICAvKiogYWQgc2xvdC9udW1iZXIgKi9cbiAgQElucHV0KCkgYWRTbG90OiBzdHJpbmcgfCBudW1iZXI7XG4gIEBJbnB1dCgpIGFkRm9ybWF0OiBzdHJpbmc7XG4gIC8qKiBjYW4gYmUgbWFudWFsbHkgc2V0IGlmIHlvdSBuZWVkIGFsbCBhZHMgb24gYSBwYWdlIHRvIGhhdmUgc2FtZSBpZCBwYWdlLXh4eCAqL1xuICBASW5wdXQoKSBhZFJlZ2lvbiA9ICdwYWdlLScgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMCkgKyAxO1xuICAvKiogaW5zIGVsZW1lbnQgZGlzcGxheSBzdHlsZSAqL1xuICBASW5wdXQoKSBkaXNwbGF5OiBzdHJpbmc7XG4gIC8qKiBpbnMgZWxlbWVudCBoZWlnaHQgaW4gcHggKi9cbiAgQElucHV0KCkgd2lkdGg6IG51bWJlcjtcbiAgLyoqIGlucyBlbGVtZW50IHdpZHRoIGluIHB4ICovXG4gIEBJbnB1dCgpIGhlaWdodDogbnVtYmVyO1xuICAvKiogdXNlZCBmb3IgaW4tZmVlZCBhZHMgKi9cbiAgQElucHV0KCkgbGF5b3V0OiBzdHJpbmc7XG4gIC8qKiB1c2VkIGZvciBpbi1mZWVkIGFkcyAqL1xuICBASW5wdXQoKSBsYXlvdXRLZXk6IHN0cmluZztcbiAgLyoqIGVuYWJsZSBwYWdlLWxldmVsIGFkcyAqL1xuICBASW5wdXQoKSBwYWdlTGV2ZWxBZHM6IGJvb2xlYW47XG4gIC8qKiBvbiBmaXJzdCBsb2FkIHNvbWV0aW1lcyBhZHNlbnNlIGlzIG5vdCByZWFkeSAqL1xuICBASW5wdXQoKSB0aW1lT3V0UmV0cnk6IG51bWJlcjtcbiAgLyoqIHNldHMgdXAgc29tZSBzb3J0IG9mIGdvb2dsZSB0ZXN0IGFkICovXG4gIEBJbnB1dCgpIGFkdGVzdDogc3RyaW5nO1xuICAvKiB1c2VkIGZvciBmbGV4aWJsZSBhZHMgKi9cbiAgQElucHV0KCkgZnVsbFdpZHRoUmVzcG9uc2l2ZTogYm9vbGVhbjtcbiAgLyoqXG4gICAqIGNsYXNzZXMgYXBwbGllZCB0byB0aGUgaW5zIGVsZW1lbnRcbiAgICovXG4gIEBJbnB1dCgpIGNsYXNzTmFtZTogc3RyaW5nO1xuICBAVmlld0NoaWxkKCdpbnMnLCB7IHJlYWQ6IEVsZW1lbnRSZWYsIHN0YXRpYzogdHJ1ZSB9KSBpbnM6IGFueTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBASW5qZWN0KEFEU0VOU0VfVE9LRU4pIHByaXZhdGUgY29uZmlnOiBBZHNlbnNlQ29uZmlnLFxuICApIHsgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuY29uZmlnO1xuICAgIGZ1bmN0aW9uIHVzZTxUPihzb3VyY2U6IFQsIGRlZmF1bHRWYWx1ZTogVCk6IFQge1xuICAgICAgcmV0dXJuIGNvbmZpZyAmJiBzb3VyY2UgIT09IHVuZGVmaW5lZCA/IHNvdXJjZSA6IGRlZmF1bHRWYWx1ZTtcbiAgICB9XG4gICAgdGhpcy5hZENsaWVudCA9IHVzZSh0aGlzLmFkQ2xpZW50LCBjb25maWcuYWRDbGllbnQpO1xuICAgIHRoaXMuYWRTbG90ID0gdXNlKHRoaXMuYWRTbG90LCBjb25maWcuYWRTbG90KTtcbiAgICB0aGlzLmFkRm9ybWF0ID0gdXNlKHRoaXMuYWRGb3JtYXQsIGNvbmZpZy5hZEZvcm1hdCB8fCAnYXV0bycpO1xuICAgIHRoaXMuZGlzcGxheSA9IHVzZSh0aGlzLmRpc3BsYXksIGNvbmZpZy5kaXNwbGF5IHx8ICdibG9jaycpO1xuICAgIHRoaXMud2lkdGggPSB1c2UodGhpcy53aWR0aCwgY29uZmlnLndpZHRoKTtcbiAgICB0aGlzLmhlaWdodCA9IHVzZSh0aGlzLmhlaWdodCwgY29uZmlnLmhlaWdodCk7XG4gICAgdGhpcy5sYXlvdXQgPSB1c2UodGhpcy5sYXlvdXQsIGNvbmZpZy5sYXlvdXQpO1xuICAgIHRoaXMubGF5b3V0S2V5ID0gdXNlKHRoaXMubGF5b3V0S2V5LCBjb25maWcubGF5b3V0S2V5KTtcbiAgICB0aGlzLnBhZ2VMZXZlbEFkcyA9IHVzZSh0aGlzLnBhZ2VMZXZlbEFkcywgY29uZmlnLnBhZ2VMZXZlbEFkcyk7XG4gICAgdGhpcy50aW1lT3V0UmV0cnkgPSB1c2UodGhpcy50aW1lT3V0UmV0cnksIGNvbmZpZy50aW1lT3V0UmV0cnkgfHwgMjAwKTtcbiAgICB0aGlzLmFkdGVzdCA9IHVzZSh0aGlzLmFkdGVzdCwgY29uZmlnLmFkdGVzdCk7XG4gICAgdGhpcy5mdWxsV2lkdGhSZXNwb25zaXZlID0gdXNlKHRoaXMuZnVsbFdpZHRoUmVzcG9uc2l2ZSwgY29uZmlnLmZ1bGxXaWR0aFJlc3BvbnNpdmUpO1xuICB9XG4gIG5nT25EZXN0cm95KCkge1xuICAgIGNvbnN0IGlmcmFtZSA9IHRoaXMuaW5zLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignaWZyYW1lJyk7XG4gICAgaWYgKGlmcmFtZSAmJiBpZnJhbWUuY29udGVudFdpbmRvdykge1xuICAgICAgaWZyYW1lLnNyYyA9ICdhYm91dDpibGFuayc7XG4gICAgICBpZnJhbWUucmVtb3ZlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGF0dGVtcHRzIHRvIHB1c2ggdGhlIGFkIHR3aWNlLiBVc3VhbGx5IGlmIG9uZSBkb2Vzbid0IHdvcmsgdGhlIG90aGVyXG4gICAqIHdpbGwgZGVwZWRpbmcgb24gaWYgdGhlIGJyb3dzZXIgaGFzIHRoZSBhZHNlbnNlIGNvZGUgY2FjaGVkIGFuZFxuICAgKiBpZiBpdHMgdGhlIGZpcnN0IHBhZ2UgdG8gYmUgbG9hZGVkXG4gICAqL1xuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgY29uc3QgcmVzID0gdGhpcy5wdXNoKCk7XG4gICAgaWYgKHJlcyBpbnN0YW5jZW9mIFR5cGVFcnJvcikge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnB1c2goKSwgdGhpcy50aW1lT3V0UmV0cnkpO1xuICAgIH1cbiAgfVxuXG4gIHB1c2goKSB7XG4gICAgY29uc3QgcDogYW55ID0ge307XG4gICAgaWYgKHRoaXMucGFnZUxldmVsQWRzKSB7XG4gICAgICBwLmdvb2dsZV9hZF9jbGllbnQgPSB0aGlzLmFkQ2xpZW50O1xuICAgICAgcC5lbmFibGVfcGFnZV9sZXZlbF9hZHMgPSB0cnVlO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgYWRzYnlnb29nbGUgPSAod2luZG93IGFzIGFueSkuYWRzYnlnb29nbGU7XG4gICAgICBhZHNieWdvb2dsZS5wdXNoKHApO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIGU7XG4gICAgfVxuICB9XG59XG5cbiJdfQ==